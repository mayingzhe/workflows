app:
  description: æ™ºèƒ½å·¥å•è¯†åˆ«ç³»ç»Ÿ
  icon: ğŸ¤–
  icon_background: '#FFEAD5'
  mode: advanced-chat
  name: æ™ºèƒ½å·¥å•è¯†åˆ«ç³»ç»Ÿ
  use_icon_as_answer_icon: false
dependencies:
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: qiangxinglin/excel_tools:0.0.5@81147a24fa4dc871759a759bda9cf024efdba3c525815e40daba74bd7ee89c4b
    version: null
- current_identifier: null
  type: marketplace
  value:
    marketplace_plugin_unique_identifier: langgenius/gemini:0.7.2@6e53b92877de2507ce83f2fc32ddf54a9662e4b5ef9e7e5d17bd18153a6485da
    version: null
kind: app
version: 0.5.0
workflow:
  conversation_variables: []
  environment_variables: []
  features:
    file_upload:
      allowed_file_extensions:
      - .JPG
      - .JPEG
      - .PNG
      - .GIF
      - .WEBP
      - .SVG
      allowed_file_types:
      - image
      - document
      allowed_file_upload_methods:
      - remote_url
      - local_file
      enabled: true
      fileUploadConfig:
        audio_file_size_limit: 50
        batch_count_limit: 5
        file_size_limit: 15
        image_file_batch_limit: 10
        image_file_size_limit: 10
        single_chunk_attachment_limit: 10
        video_file_size_limit: 100
        workflow_file_upload_limit: 10
      image:
        enabled: false
        number_limits: 3
        transfer_methods:
        - local_file
        - remote_url
      number_limits: 3
    opening_statement: ''
    retriever_resource:
      enabled: true
    sensitive_word_avoidance:
      enabled: false
    speech_to_text:
      enabled: false
    suggested_questions: []
    suggested_questions_after_answer:
      enabled: false
    text_to_speech:
      enabled: false
      language: ''
      voice: ''
  graph:
    edges:
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: llm
        targetType: code
      id: llm-source-1767164062417-target
      source: llm
      sourceHandle: source
      target: '1767164062417'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: code
        targetType: tool
      id: 1767164062417-source-1767164097886-target
      source: '1767164062417'
      sourceHandle: source
      target: '1767164097886'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: tool
        targetType: answer
      id: 1767164097886-source-answer-target
      source: '1767164097886'
      sourceHandle: source
      target: answer
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: start
        targetType: answer
      id: 1767163493896-source-1767166318423-target
      source: '1767163493896'
      sourceHandle: source
      target: '1767166318423'
      targetHandle: target
      type: custom
      zIndex: 0
    - data:
        isInIteration: false
        isInLoop: false
        sourceType: answer
        targetType: llm
      id: 1767166318423-source-llm-target
      source: '1767166318423'
      sourceHandle: source
      target: llm
      targetHandle: target
      type: custom
      zIndex: 0
    nodes:
    - data:
        selected: false
        title: ç”¨æˆ·è¾“å…¥
        type: start
        variables: []
      height: 73
      id: '1767163493896'
      position:
        x: 96
        y: 254
      positionAbsolute:
        x: 96
        y: 254
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        context:
          enabled: false
          variable_selector: []
        memory:
          query_prompt_template: '{{#sys.query#}}


            {{#sys.files#}}'
          role_prefix:
            assistant: ''
            user: ''
          window:
            enabled: false
            size: 10
        model:
          completion_params:
            temperature: 0.7
          mode: chat
          name: gemini-3-pro-preview
          provider: langgenius/gemini/google
        prompt_template:
        - id: 59da8f42-3716-40ba-b146-4bf12d2c96f0
          role: system
          text: "ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„å·¥ä¸šæ–‡æ¡£æ•°å­—åŒ–ä¸“å®¶ã€‚è¯·è¯†åˆ«æä¾›çš„â€œMES-ç‰©æ–™æµè½¬å¡â€å›¾ç‰‡ï¼Œå¹¶ä¸¥æ ¼æŒ‰ç…§ä»¥ä¸‹ JSON æ ¼å¼è¾“å‡ºä¿¡æ¯ã€‚\nè¯†åˆ«è¦æ±‚ï¼š\n\
            åŸºæœ¬ä¿¡æ¯ï¼šåŒ…æ‹¬å…¬å¸åã€äº§å“åç§°ã€ç¼–ç ã€å‹å·ã€æ—¥æœŸç­‰ã€‚\næ‰‹å†™ä½“è¯†åˆ«ï¼šé¡µé¢é¡¶éƒ¨çš„æ‰‹å†™ä½“ä¸éœ€è¦è¯†åˆ«ï¼Œâ€œæ“ä½œå·¥/è´¨æ£€å‘˜â€æ‰‹å†™ç­¾å­—ã€é™„åŠ é¡¹ç›®ä¸­çš„æ‰‹å†™ä¿¡æ¯åŠ¡å¿…è¦è¯†åˆ«å‡†ç¡®ã€‚\n\
            çŠ¶æ€åˆ¤æ–­ï¼šå¦‚æœæ“ä½œå·¥å¤„æœ‰ç­¾å­—ï¼Œåˆ™Â is_signedÂ ä¸º trueã€‚\næä¾›çš„æ–‡ä»¶ä¸­åŒ…å«å¤šä¸ªâ€œMES-ç‰©æ–™æµè½¬å¡â€é¡µé¢ã€‚è¯·é€é¡µè¯†åˆ«æ‰€æœ‰å·¥å•ï¼Œå¹¶å°†ç»“æœåˆå¹¶ä¸ºä¸€ä¸ªÂ JSON\
            \ æ•°ç»„ï¼ˆListï¼‰Â è¾“å‡º\nè¾“å‡ºæ ¼å¼ï¼šåªè¾“å‡º JSON å­—ç¬¦ä¸²ï¼Œä¸è¦åŒ…å« Markdown ä»£ç å—ã€‚\nJSON ç»“æ„ç¤ºä¾‹ï¼š\n[{\n\
            \  \"header\": {\n    \"qr_code_text\": \"XZ25100375-02-004-1\",\n   \
            \ \"company\": \"å…´æºç¯ä¿è®¾å¤‡æœ‰é™å…¬å¸\",\n    \"print_date\": \"2025/11/21 14:20\"\
            ,\n    \"doc_type\": \"MES-ç‰©æ–™æµè½¬å¡\"\n  },\n  \"product_info\": {\n    \"\
            name\": \"æ»‘å—æŒ¡å—|XZ25010007.YJ1021.12.80-02/SUS316L\",\n    \"code\": \"\
            4001011172\",\n    \"model\": \"XZ25010007.YJ1021.12.80-02/SUS316L\",\n\
            \    \"start_date\": \"2025-11-21\",\n    \"end_date\": \"2025-12-03\"\
            ,\n    \"quantity\": 2,\n    \"auxiliary_item\": \"XZ25100375-02\",\n\
            \    \"storage_location\": \"ä¸‹æ–™ä»“\",   // å¦‚æœåŸæ–‡ä¸ºç©ºï¼Œè¯·ä¿æŒç©ºå­—ç¬¦ä¸²\n    \"remark\"\
            : \"XZ25100375-02-004\",\n    \"print_count\": 1 \n  },\n  \"process_details\"\
            : [\n    {\n      \"process_name\": \"1.æ¿€å…‰åˆ‡å‰²\",\n      \"work_center\"\
            : \"è‡ªåˆ¶1è½¦é—´-ä¸‹æ–™ç»„\",\n      \"quantity\": 2,\n      \"operator_signature\"\
            : \"äº¢å»ºé£\",\n      \"unit_time\": \"2.4(åˆ†é’Ÿ)\",\n      \"additional_man_hours\"\
            : \"4(åˆ†é’Ÿ)\",       // æ³¨æ„æå–è¡¨æ ¼ä¸­â€œé™„åŠ å·¥æ—¶â€æˆ–â€œé™„åŠ å·¥â€æ çš„æ•°å­—ï¼Œå¦‚æœåŸæ–‡ä¸ºç©ºï¼Œè¯·ä¿æŒç©ºå­—ç¬¦ä¸²\n      \"\
            additional_item\": \"\",        // æ³¨æ„æå–è¡¨æ ¼ä¸­â€œé™„åŠ é¡¹â€æ çš„å†…å®¹ï¼Œå¦‚æœå†…å®¹ä¸ºäººåå’Œæ—¥æœŸå®ƒå±äºauditorå†…å®¹ï¼Œä¸ç”¨æå–ï¼Œå¦‚æœåŸæ–‡ä¸ºç©ºï¼Œè¯·ä¿æŒç©ºå­—ç¬¦ä¸²\n\
            \      \"row_remark\": \"\",              // æ³¨æ„æå–è¡¨æ ¼ä¸­â€œå¤‡æ³¨â€æ çš„å†…å®¹ï¼Œå¦‚æœåŸæ–‡ä¸ºç©ºï¼Œè¯·ä¿æŒç©ºå­—ç¬¦ä¸²\n\
            \      \"auditor\": { \n             \"name\": \"éƒ­æ—\", // ä½äºè¡¨æ ¼å³ä¾§æˆ–ä¸‹æ–¹çš„å®¡æ ¸/å¤æ ¸ç­¾å­—\n\
            \             \"date\": \"12.3\"  // ç­¾å­—æ—è¾¹çš„æ—¥æœŸ\n      }\n    }\n  ]\n}\n\
            ]"
        selected: false
        title: LLM
        type: llm
        vision:
          enabled: false
      height: 88
      id: llm
      position:
        x: 680
        y: 282
      positionAbsolute:
        x: 680
        y: 282
      selected: true
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: '{{#1767164062417.origin_json#}}{{#1767164097886.files#}}'
        selected: false
        title: ç›´æ¥å›å¤
        type: answer
        variables: []
      height: 122
      id: answer
      position:
        x: 1612
        y: 282
      positionAbsolute:
        x: 1612
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        code: "\nimport json\nimport re\n\ndef main(arg1: str) -> dict:\n    try:\n\
          \        # 1. åŸºç¡€ JSON æ¸…æ´— (\U0001F525 ä¿®å¤æ ¸å¿ƒ \U0001F525)\n        # ä¿®æ”¹æ­£åˆ™ï¼šåŒæ—¶åŒ¹é…ä»¥\
          \ [ å¼€å¤´çš„åˆ—è¡¨ æˆ– ä»¥ { å¼€å¤´çš„å¯¹è±¡\n        # è¿™æ ·å°±èƒ½å¤„ç†å¤šé¡µå·¥å•ç”Ÿæˆçš„ [...] æ ¼å¼äº†\n        match\
          \ = re.search(r'(\\[.*\\]|\\{.*\\})', arg1, re.DOTALL)\n        clean_str\
          \ = match.group() if match else arg1.strip()\n        \n        # å°è¯•è§£æ\n\
          \        try:\n            data = json.loads(clean_str)\n        except\
          \ json.JSONDecodeError:\n            # å…œåº•ï¼šå¦‚æœè¿˜æŠ¥é”™ï¼Œå¯èƒ½æ˜¯å¤šä¸ªå¯¹è±¡æ²¡åŒ…åœ¨åˆ—è¡¨é‡Œï¼Œå°è¯•å¼ºåˆ¶åŒ…ä¸€å±‚\n\
          \            # è¿™ç§æƒ…å†µå°‘è§ï¼Œä½†èƒ½æ•‘å‘½\n            clean_str = f\"[{clean_str}]\".replace(\"\
          } {\", \"}, {\")\n            data = json.loads(clean_str)\n        \n \
          \       # === A. ä¸­æ–‡æ ‡é¢˜æ˜ å°„ (ä¿æŒæ‚¨çš„å®šåˆ¶éœ€æ±‚) ===\n        key_map = {\n          \
          \  # --- å¤´éƒ¨ä¿¡æ¯ ---\n            \"qr_code_text\": \"äºŒç»´ç å†…å®¹\",\n          \
          \  \"company\": \"å…¬å¸åç§°\",\n            \"print_date\": \"æ‰“å°æ—¶é—´\",\n     \
          \       \"doc_type\": \"å•æ®ç±»å‹\",\n            \"product_name\": \"äº§å“åç§°\"\
          ,\n            \"name\": \"äº§å“åç§°\",\n            \"product_code\": \"äº§å“ç¼–ç \"\
          ,\n            \"code\": \"äº§å“ç¼–ç \",\n            \"product_model\": \"äº§å“å‹å·\"\
          ,\n            \"model\": \"äº§å“å‹å·\",\n            \"start_date\": \"å¼€å·¥æ—¥æœŸ\"\
          ,\n            \"end_date\": \"å®Œå·¥æ—¥æœŸ\",\n            \"quantity\": \"ç”Ÿäº§æ•°é‡\"\
          , \n            \"auxiliary_item\": \"è¾…åŠ©é¡¹\",\n            \"storage_location\"\
          : \"å…¥åº“è‡³\",    # æ‚¨çš„å®šåˆ¶ï¼šå…¥åº“è‡³\n            \"remark\": \"å¤‡æ³¨\",\n            \"\
          remarks\": \"å¤‡æ³¨\",\n            \"print_count\": \"æ‰“å°æ¬¡æ•°\",\n           \
          \ \n            # --- å·¥åºä¿¡æ¯ ---\n            \"process_name\": \"å·¥åºåç§°\",\n\
          \            \"work_center\": \"å·¥ä½œä¸­\",        # æ‚¨çš„å®šåˆ¶ï¼šå·¥ä½œä¸­\n            \"\
          process_quantity\": \"æ•°é‡\",     # æ‚¨çš„å®šåˆ¶ï¼šç´§è·Ÿåœ¨å·¥ä½œä¸­åé¢\n            \"operator_signature\"\
          : \"æ“ä½œå·¥/ç­¾å\",\n            \"operator\": \"æ“ä½œå·¥\",\n            \"unit_time\"\
          : \"å•ä»¶å·¥æ—¶\",\n            \"additional_man_hours\": \"é™„åŠ å·¥æ—¶\",\n         \
          \   \"additional_item\": \"é™„åŠ é¡¹ç›®\",\n            \"row_remark\": \"è¡Œå¤‡æ³¨\"\
          ,\n            \"auditor_name\": \"å®¡æ ¸äºº\",\n            \"auditor_date\"\
          : \"å®¡æ ¸æ—¥æœŸ\"\n        }\n        \n        # === B. æ¸…æ´—å‡½æ•° ===\n        def\
          \ clean_for_excel(text):\n            if text is None:\n               \
          \ return \"\"\n            text_str = str(text).strip()\n            # æ¸…æ´—éæ³•å­—ç¬¦\n\
          \            text_str = re.sub(r'[\\x00-\\x08\\x0B\\x0C\\x0E-\\x1F\\x7F]',\
          \ '', text_str)\n            if text_str and text_str[0] in ['=', '+', '-',\
          \ '@']:\n                text_str = \"'\" + text_str\n            return\
          \ text_str\n\n        # === C. ä¸»é€»è¾‘ ===\n        origin_data = data\n   \
          \     horizontal_list = [] \n        \n        # å…¼å®¹å¤„ç†ï¼šæ— è®º LLM è¿”å›çš„æ˜¯å•ä¸ªå¯¹è±¡è¿˜æ˜¯åˆ—è¡¨ï¼Œéƒ½ç»Ÿä¸€è½¬ä¸ºåˆ—è¡¨éå†\n\
          \        job_orders = data if isinstance(data, list) else [data]\n     \
          \   \n        for order in job_orders:\n            if isinstance(order,\
          \ dict):\n                order_lower = {k.lower(): v for k, v in order.items()}\n\
          \                \n                common_info = {}\n                if\
          \ \"header\" in order_lower and isinstance(order_lower[\"header\"], dict):\n\
          \                    common_info.update(order_lower[\"header\"])\n     \
          \           if \"product_info\" in order_lower and isinstance(order_lower[\"\
          product_info\"], dict):\n                    common_info.update(order_lower[\"\
          product_info\"])\n                \n                process_list = order_lower.get(\"\
          process_details\", [])\n                if not isinstance(process_list,\
          \ list) or len(process_list) == 0:\n                    process_list = [{}]\
          \ \n\n                for item in process_list:\n                    if\
          \ isinstance(item, dict):\n                        # 1. å±•å¹³ auditor\n   \
          \                     if \"auditor\" in item and isinstance(item[\"auditor\"\
          ], dict):\n                            auditor_info = item.pop(\"auditor\"\
          )\n                            for ak, av in auditor_info.items():\n   \
          \                             item[f\"auditor_{ak}\"] = av\n           \
          \             \n                        # 2. æå–å·¥åºæ•°é‡\n                  \
          \      if \"quantity\" in item:\n                            item[\"process_quantity\"\
          ] = item.pop(\"quantity\")\n                        \n                 \
          \       # 3. åˆå¹¶\n                        merged_row = {**common_info, **item}\n\
          \                        \n                        # 4. æŒ‰ key_map é¡ºåºè¾“å‡º\n\
          \                        translated_row = {}\n                        \n\
          \                        for en_key, cn_key in key_map.items():\n      \
          \                      val = merged_row.get(en_key, \"\")\n            \
          \                translated_row[cn_key] = clean_for_excel(val)\n       \
          \                 \n                        horizontal_list.append(translated_row)\n\
          \        \n        # å…œåº•\n        if not horizontal_list:\n            horizontal_list\
          \ = [{\"æç¤º\": \"æœªæå–åˆ°æ•°æ®\"}]\n\n        return {\n            \"result_json\"\
          : json.dumps(horizontal_list, ensure_ascii=False),\n            \"origin_json\"\
          : json.dumps(origin_data, ensure_ascii=False, indent=4)\n        }\n\n \
          \   except Exception as e:\n        err_msg = str(e)\n        return {\n\
          \            \"result_json\": json.dumps([{\"é”™è¯¯ä¿¡æ¯\": err_msg}], ensure_ascii=False),\n\
          \            \"origin_json\": json.dumps({\"error\": err_msg}, ensure_ascii=False,\
          \ indent=4)\n        }\n"
        code_language: python3
        outputs:
          origin_json:
            children: null
            type: string
          result_json:
            children: null
            type: string
        selected: false
        title: ä»£ç æ‰§è¡Œ
        type: code
        variables:
        - value_selector:
          - llm
          - text
          value_type: string
          variable: arg1
      height: 52
      id: '1767164062417'
      position:
        x: 1012
        y: 282
      positionAbsolute:
        x: 1012
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        is_team_authorization: true
        paramSchemas:
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: The JSON string to convert.
            ja_JP: The JSON string to convert.
            pt_BR: The JSON string to convert.
            zh_Hans: è¦è½¬æ¢çš„JSONå­—ç¬¦ä¸²ã€‚
          label:
            en_US: JSON String
            ja_JP: JSON String
            pt_BR: JSON String
            zh_Hans: JSONå­—ç¬¦ä¸²
          llm_description: The JSON string to convert.
          max: null
          min: null
          name: json_str
          options: []
          placeholder: null
          precision: null
          required: true
          scope: null
          template: null
          type: string
        - auto_generate: null
          default: null
          form: llm
          human_description:
            en_US: The filename for the generated Excel file
            ja_JP: The filename for the generated Excel file
            pt_BR: The filename for the generated Excel file
            zh_Hans: ç”Ÿæˆçš„Excelæ–‡ä»¶çš„æ–‡ä»¶å
          label:
            en_US: Excel filename
            ja_JP: Excel filename
            pt_BR: Excel filename
            zh_Hans: Excelæ–‡ä»¶å
          llm_description: The filename that will be used for the generated Excel
            file
          max: null
          min: null
          name: filename
          options: []
          placeholder: null
          precision: null
          required: false
          scope: null
          template: null
          type: string
        params:
          filename: ''
          json_str: ''
        plugin_id: qiangxinglin/excel_tools
        plugin_unique_identifier: qiangxinglin/excel_tools:0.0.5@81147a24fa4dc871759a759bda9cf024efdba3c525815e40daba74bd7ee89c4b
        provider_icon: /console/api/workspaces/current/plugin/icon?tenant_id=a64d99eb-0a15-4e3e-89cd-1fd11a5519a2&filename=633fbc546fec8855ed43a00343339462654d57473a79fc63b2858c1462470672.svg
        provider_id: qiangxinglin/excel_tools/excel_tools
        provider_name: qiangxinglin/excel_tools/excel_tools
        provider_type: builtin
        selected: false
        title: Jsonè½¬Excel
        tool_configurations: {}
        tool_description: å°†Jsonè½¬æ¢ä¸ºExcelã€‚
        tool_label: Jsonè½¬Excel
        tool_name: json2excel
        tool_node_version: '2'
        tool_parameters:
          filename:
            type: mixed
            value: null
          json_str:
            type: mixed
            value: '{{#1767164062417.result_json#}}'
        type: tool
      height: 52
      id: '1767164097886'
      position:
        x: 1312
        y: 282
      positionAbsolute:
        x: 1312
        y: 282
      selected: false
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    - data:
        answer: æ”¶åˆ°æ‚¨çš„å·¥å•æ–‡ä»¶ï¼æ­£åœ¨è¿›è¡Œ OCR è¯†åˆ«å’Œæ•°æ®æå–ï¼Œç”Ÿæˆ Excel éœ€è¦ä¸€ç‚¹æ—¶é—´ï¼Œè¯·æ‚¨è€å¿ƒç­‰å¾…...
        selected: false
        title: ç›´æ¥å›å¤ 2
        type: answer
        variables: []
      height: 132
      id: '1767166318423'
      position:
        x: 380
        y: 282
      positionAbsolute:
        x: 380
        y: 282
      sourcePosition: right
      targetPosition: left
      type: custom
      width: 242
    viewport:
      x: 138.7935899604705
      y: 83.4295487242673
      zoom: 0.6597539553864471
  rag_pipeline_variables: []
